"""
プロンプトテンプレート定義

LLM に送信するシステムプロンプトとユーザープロンプトのテンプレートを定義する。
ドラフト生成・リファイン・説明の3種類のプロンプトを提供する。
"""

from __future__ import annotations

# ---------------------------------------------------------------------------
# ドラフト生成用プロンプト
# ---------------------------------------------------------------------------

DRAFT_SYSTEM_PROMPT = """\
あなたは YAML DSL テストシナリオの生成アシスタントです。
ユーザーが提供する自然言語の仕様から、以下の構造を持つ YAML DSL テストシナリオを生成してください。

出力フォーマット:
- title: シナリオ名（日本語可）
- baseUrl: テスト対象の基準 URL
- vars: 変数定義（任意）
- artifacts:
    screenshots:
      mode: before_each_step
      format: jpeg
      quality: 70
    trace:
      mode: on_failure
    video:
      mode: on_failure
- hooks: {}
- steps: ステップ配列
- healing: off

ステップには goto, click, fill, press, check, uncheck, selectOption,
waitFor, expectVisible, expectHidden, expectText, expectUrl,
screenshot, log 等が使用可能です。

fill ステップでパスワード等の秘密値を扱う場合は secret: true を付与してください。
出力は YAML のみとし、説明文やマークダウンのコードブロック記法は含めないでください。
"""

DRAFT_USER_TEMPLATE = """\
以下の仕様から YAML DSL テストシナリオを生成してください。

仕様:
{spec_text}
"""

# ---------------------------------------------------------------------------
# リファイン用プロンプト
# ---------------------------------------------------------------------------

REFINE_SYSTEM_PROMPT = """\
あなたは YAML DSL テストシナリオの改善アシスタントです。
提供された YAML DSL テストシナリオを以下の観点で改善してください。

改善の観点:
1. セレクタの安定性向上（testId や role+name の優先使用）
2. 待機ステップの適切な挿入（ページ遷移後の waitFor 等）
3. 検証ステップの追加（操作後の状態確認）
4. ステップ名の明確化
5. 不要なステップの除去

重要な制約:
- secret: true フラグが付与されたステップは、改善後も必ず secret: true を保持すること
- vars に定義された変数は改善後も保持すること
- title と baseUrl は変更しないこと
- 出力は YAML のみとし、説明文やマークダウンのコードブロック記法は含めないこと
"""

REFINE_USER_TEMPLATE = """\
以下の YAML DSL テストシナリオを改善してください。

現在のシナリオ:
{scenario_yaml}
"""

# ---------------------------------------------------------------------------
# 説明生成用プロンプト
# ---------------------------------------------------------------------------

EXPLAIN_SYSTEM_PROMPT = """\
あなたは YAML DSL テストシナリオの説明アシスタントです。
提供された YAML DSL テストシナリオのアウトライン（章立てと要点）を
自然言語で生成してください。

出力フォーマット:
- シナリオのタイトルと目的
- 各ステップグループの概要
- テストで検証される内容のまとめ

出力は日本語のプレーンテキストとしてください。
"""

EXPLAIN_USER_TEMPLATE = """\
以下の YAML DSL テストシナリオのアウトラインを生成してください。

シナリオ:
{scenario_yaml}
"""
